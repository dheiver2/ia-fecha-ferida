// Padr√µes Internacionais: HL7 FHIR R4 + DICOM + IHE
export interface MedicalReportTemplate {
  // HL7 FHIR DiagnosticReport Resource Structure
  resourceType: 'DiagnosticReport';
  id: string;
  meta: FHIRMeta;
  identifier: Identifier[];
  basedOn?: Reference[];
  status: DiagnosticReportStatus;
  category: CodeableConcept[];
  code: CodeableConcept;
  subject: Reference;
  encounter?: Reference;
  effectiveDateTime: string;
  issued: string;
  performer: Reference[];
  resultsInterpreter?: Reference[];
  specimen?: Reference[];
  result?: Reference[];
  imagingStudy?: Reference[];
  media?: DiagnosticReportMedia[];
  conclusion?: string;
  conclusionCode?: CodeableConcept[];
  presentedForm?: Attachment[];
  
  // Extended fields for wound care
  header: ReportHeader;
  patientInfo: PatientInfo;
  examination: ExaminationDetails;
  findings: ClinicalFindings;
  diagnosis: DiagnosisSection;
  recommendations: TreatmentRecommendations;
  cardiovascularSystemicRiskAnalysis?: CardiovascularSystemicRiskAnalysis;
  prognosisAnalysis?: PrognosisAnalysis;
  personalizedRecommendations?: PersonalizedRecommendations;
  treatmentOptimization?: TreatmentOptimization;
  qualityOfLife?: QualityOfLife;
  followUpPlan?: FollowUpPlan;
  evidenceBased?: EvidenceBased;
  footer: ReportFooter;
  
  // DICOM compliance
  dicomMetadata: DICOMMetadata;
  
  // IHE XDS-I compliance
  xdsMetadata: XDSMetadata;
}

// HL7 FHIR Base Types
export interface FHIRMeta {
  versionId?: string;
  lastUpdated?: string;
  source?: string;
  profile?: string[];
  security?: Coding[];
  tag?: Coding[];
}

export interface Identifier {
  use?: 'usual' | 'official' | 'temp' | 'secondary' | 'old';
  type?: CodeableConcept;
  system?: string;
  value: string;
  period?: Period;
  assigner?: Reference;
}

export interface Reference {
  reference?: string;
  type?: string;
  identifier?: Identifier;
  display?: string;
}

export interface CodeableConcept {
  coding?: Coding[];
  text?: string;
}

export interface Coding {
  system?: string;
  version?: string;
  code?: string;
  display?: string;
  userSelected?: boolean;
}

export interface Period {
  start?: string;
  end?: string;
}

export interface Attachment {
  contentType?: string;
  language?: string;
  data?: string;
  url?: string;
  size?: number;
  hash?: string;
  title?: string;
  creation?: string;
}

export interface DiagnosticReportMedia {
  comment?: string;
  link: Reference;
}

export type DiagnosticReportStatus = 
  | 'registered' 
  | 'partial' 
  | 'preliminary' 
  | 'final' 
  | 'amended' 
  | 'corrected' 
  | 'appended' 
  | 'cancelled' 
  | 'entered-in-error' 
  | 'unknown';

// DICOM Metadata Structure
export interface DICOMMetadata {
  studyInstanceUID: string;
  seriesInstanceUID: string;
  sopInstanceUID: string;
  studyDate: string;
  studyTime: string;
  modality: string; // 'XC' for External-camera Photography
  manufacturer: string;
  manufacturerModelName: string;
  softwareVersions: string[];
  patientID: string;
  patientName: string;
  patientBirthDate: string;
  patientSex: 'M' | 'F' | 'O' | 'U';
  bodyPartExamined: string;
  viewPosition?: string;
  imageType: string[];
  acquisitionDateTime: string;
  contentDate: string;
  contentTime: string;
  instanceCreationDate: string;
  instanceCreationTime: string;
  specificCharacterSet: string;
  imageComments?: string;
  burnedInAnnotation: 'YES' | 'NO';
  recognizableVisualFeatures: 'YES' | 'NO';
  lossyImageCompression: '00' | '01';
  photometricInterpretation: string;
  samplesPerPixel: number;
  bitsAllocated: number;
  bitsStored: number;
  highBit: number;
  pixelRepresentation: number;
  rows: number;
  columns: number;
  pixelSpacing?: number[];
  windowCenter?: number;
  windowWidth?: number;
}

// IHE XDS-I Metadata
export interface XDSMetadata {
  documentUniqueId: string;
  repositoryUniqueId: string;
  documentEntryUUID: string;
  submissionSetUniqueId: string;
  patientId: string;
  sourcePatientId: string;
  classCode: CodeableConcept;
  typeCode: CodeableConcept;
  practiceSettingCode: CodeableConcept;
  healthcareFacilityTypeCode: CodeableConcept;
  eventCodeList: CodeableConcept[];
  confidentialityCode: CodeableConcept;
  formatCode: CodeableConcept;
  languageCode: string;
  serviceStartTime: string;
  serviceStopTime: string;
  title: string;
  comments?: string;
  hash: string;
  size: number;
  mimeType: string;
}

export interface ReportHeader {
  // Standard medical report header
  title: string;
  protocol: string;
  date: string;
  time: string;
  institution: string;
  system: string;
  version: string;
  responsiblePhysician: string;
  crm: string;
  
  // International compliance
  reportType: 'DIAGNOSTIC_IMAGING' | 'PATHOLOGY' | 'WOUND_ASSESSMENT';
  urgency: 'ROUTINE' | 'URGENT' | 'STAT';
  confidentiality: 'NORMAL' | 'RESTRICTED' | 'VERY_RESTRICTED';
  
  // HL7 FHIR identifiers
  fhirIdentifier: Identifier;
  
  // DICOM Study identifiers
  studyInstanceUID: string;
  accessionNumber: string;
  
  // IHE XDS identifiers
  documentUniqueId: string;
  repositoryUniqueId: string;
}

export interface PatientInfo {
  // HL7 FHIR Patient Resource compliance
  resourceType: 'Patient';
  id: string;
  identifier: Identifier[];
  active?: boolean;
  name: HumanName[];
  telecom?: ContactPoint[];
  gender?: 'male' | 'female' | 'other' | 'unknown';
  birthDate?: string;
  deceasedBoolean?: boolean;
  deceasedDateTime?: string;
  address?: Address[];
  maritalStatus?: CodeableConcept;
  multipleBirthBoolean?: boolean;
  multipleBirthInteger?: number;
  photo?: Attachment[];
  contact?: PatientContact[];
  communication?: PatientCommunication[];
  generalPractitioner?: Reference[];
  managingOrganization?: Reference;
  link?: PatientLink[];
  
  // Legacy fields for backward compatibility
  age: string;
  patientId: string;
  lesionLocation: string;
  medicalHistory?: string;
  allergies?: string;
  currentMedications?: string;
  
  // Extended clinical information
  clinicalInfo: {
    weight?: Quantity;
    height?: Quantity;
    bmi?: number;
    bloodType?: CodeableConcept;
    allergies: AllergyIntolerance[];
    medications: MedicationStatement[];
    conditions: Condition[];
    procedures: Procedure[];
    immunizations: Immunization[];
    vitalSigns: Observation[];
  };
  
  // DICOM Patient Module
  dicomPatientInfo: {
    patientID: string;
    patientName: string; // Format: Family^Given^Middle^Prefix^Suffix
    patientBirthDate: string; // YYYYMMDD
    patientSex: 'M' | 'F' | 'O' | 'U';
    patientAge: string; // Format: nnnY, nnnM, nnnW, nnnD
    patientWeight?: string; // kg
    patientSize?: string; // m
    patientAddress?: string;
    patientTelephoneNumbers?: string;
    ethnicGroup?: string;
    patientComments?: string;
    patientSpeciesDescription?: string;
    patientBreedDescription?: string;
    responsiblePerson?: string;
    responsibleOrganization?: string;
  };
}

// HL7 FHIR Supporting Types
export interface HumanName {
  use?: 'usual' | 'official' | 'temp' | 'nickname' | 'anonymous' | 'old' | 'maiden';
  text?: string;
  family?: string;
  given?: string[];
  prefix?: string[];
  suffix?: string[];
  period?: Period;
}

export interface ContactPoint {
  system?: 'phone' | 'fax' | 'email' | 'pager' | 'url' | 'sms' | 'other';
  value?: string;
  use?: 'home' | 'work' | 'temp' | 'old' | 'mobile';
  rank?: number;
  period?: Period;
}

export interface Address {
  use?: 'home' | 'work' | 'temp' | 'old' | 'billing';
  type?: 'postal' | 'physical' | 'both';
  text?: string;
  line?: string[];
  city?: string;
  district?: string;
  state?: string;
  postalCode?: string;
  country?: string;
  period?: Period;
}

export interface PatientContact {
  relationship?: CodeableConcept[];
  name?: HumanName;
  telecom?: ContactPoint[];
  address?: Address;
  gender?: 'male' | 'female' | 'other' | 'unknown';
  organization?: Reference;
  period?: Period;
}

export interface PatientCommunication {
  language: CodeableConcept;
  preferred?: boolean;
}

export interface PatientLink {
  other: Reference;
  type: 'replaced-by' | 'replaces' | 'refer' | 'seealso';
}

export interface Quantity {
  value?: number;
  comparator?: '<' | '<=' | '>=' | '>';
  unit?: string;
  system?: string;
  code?: string;
}

// Clinical Resource Types
export interface AllergyIntolerance {
  resourceType: 'AllergyIntolerance';
  id?: string;
  identifier?: Identifier[];
  clinicalStatus?: CodeableConcept;
  verificationStatus?: CodeableConcept;
  type?: 'allergy' | 'intolerance';
  category?: ('food' | 'medication' | 'environment' | 'biologic')[];
  criticality?: 'low' | 'high' | 'unable-to-assess';
  code?: CodeableConcept;
  patient: Reference;
  onsetDateTime?: string;
  recordedDate?: string;
  recorder?: Reference;
  asserter?: Reference;
  lastOccurrence?: string;
  note?: Annotation[];
  reaction?: AllergyIntoleranceReaction[];
}

export interface AllergyIntoleranceReaction {
  substance?: CodeableConcept;
  manifestation: CodeableConcept[];
  description?: string;
  onset?: string;
  severity?: 'mild' | 'moderate' | 'severe';
  exposureRoute?: CodeableConcept;
  note?: Annotation[];
}

export interface MedicationStatement {
  resourceType: 'MedicationStatement';
  id?: string;
  identifier?: Identifier[];
  basedOn?: Reference[];
  partOf?: Reference[];
  status: 'active' | 'completed' | 'entered-in-error' | 'intended' | 'stopped' | 'on-hold' | 'unknown' | 'not-taken';
  statusReason?: CodeableConcept[];
  category?: CodeableConcept;
  medicationCodeableConcept?: CodeableConcept;
  medicationReference?: Reference;
  subject: Reference;
  context?: Reference;
  effectiveDateTime?: string;
  effectivePeriod?: Period;
  dateAsserted?: string;
  informationSource?: Reference;
  derivedFrom?: Reference[];
  reasonCode?: CodeableConcept[];
  reasonReference?: Reference[];
  note?: Annotation[];
  dosage?: Dosage[];
}

export interface Condition {
  resourceType: 'Condition';
  id?: string;
  identifier?: Identifier[];
  clinicalStatus?: CodeableConcept;
  verificationStatus?: CodeableConcept;
  category?: CodeableConcept[];
  severity?: CodeableConcept;
  code?: CodeableConcept;
  bodySite?: CodeableConcept[];
  subject: Reference;
  encounter?: Reference;
  onsetDateTime?: string;
  onsetAge?: Quantity;
  onsetPeriod?: Period;
  onsetRange?: Range;
  onsetString?: string;
  abatementDateTime?: string;
  abatementAge?: Quantity;
  abatementPeriod?: Period;
  abatementRange?: Range;
  abatementString?: string;
  recordedDate?: string;
  recorder?: Reference;
  asserter?: Reference;
  stage?: ConditionStage[];
  evidence?: ConditionEvidence[];
  note?: Annotation[];
}

export interface Procedure {
  resourceType: 'Procedure';
  id?: string;
  identifier?: Identifier[];
  instantiatesCanonical?: string[];
  instantiatesUri?: string[];
  basedOn?: Reference[];
  partOf?: Reference[];
  status: 'preparation' | 'in-progress' | 'not-done' | 'on-hold' | 'stopped' | 'completed' | 'entered-in-error' | 'unknown';
  statusReason?: CodeableConcept;
  category?: CodeableConcept;
  code?: CodeableConcept;
  subject: Reference;
  encounter?: Reference;
  performedDateTime?: string;
  performedPeriod?: Period;
  performedString?: string;
  performedAge?: Quantity;
  performedRange?: Range;
  recorder?: Reference;
  asserter?: Reference;
  performer?: ProcedurePerformer[];
  location?: Reference;
  reasonCode?: CodeableConcept[];
  reasonReference?: Reference[];
  bodySite?: CodeableConcept[];
  outcome?: CodeableConcept;
  report?: Reference[];
  complication?: CodeableConcept[];
  complicationDetail?: Reference[];
  followUp?: CodeableConcept[];
  note?: Annotation[];
  focalDevice?: ProcedureFocalDevice[];
  usedReference?: Reference[];
  usedCode?: CodeableConcept[];
}

export interface Immunization {
  resourceType: 'Immunization';
  id?: string;
  identifier?: Identifier[];
  status: 'completed' | 'entered-in-error' | 'not-done';
  statusReason?: CodeableConcept;
  vaccineCode: CodeableConcept;
  patient: Reference;
  encounter?: Reference;
  occurrenceDateTime?: string;
  occurrenceString?: string;
  recorded?: string;
  primarySource?: boolean;
  reportOrigin?: CodeableConcept;
  location?: Reference;
  manufacturer?: Reference;
  lotNumber?: string;
  expirationDate?: string;
  site?: CodeableConcept;
  route?: CodeableConcept;
  doseQuantity?: Quantity;
  performer?: ImmunizationPerformer[];
  note?: Annotation[];
  reasonCode?: CodeableConcept[];
  reasonReference?: Reference[];
  isSubpotent?: boolean;
  subpotentReason?: CodeableConcept[];
  education?: ImmunizationEducation[];
  programEligibility?: CodeableConcept[];
  fundingSource?: CodeableConcept;
  reaction?: ImmunizationReaction[];
  protocolApplied?: ImmunizationProtocolApplied[];
}

export interface Observation {
  resourceType: 'Observation';
  id?: string;
  identifier?: Identifier[];
  basedOn?: Reference[];
  partOf?: Reference[];
  status: 'registered' | 'preliminary' | 'final' | 'amended' | 'corrected' | 'cancelled' | 'entered-in-error' | 'unknown';
  category?: CodeableConcept[];
  code: CodeableConcept;
  subject?: Reference;
  focus?: Reference[];
  encounter?: Reference;
  effectiveDateTime?: string;
  effectivePeriod?: Period;
  effectiveTiming?: Timing;
  effectiveInstant?: string;
  issued?: string;
  performer?: Reference[];
  valueQuantity?: Quantity;
  valueCodeableConcept?: CodeableConcept;
  valueString?: string;
  valueBoolean?: boolean;
  valueInteger?: number;
  valueRange?: Range;
  valueRatio?: Ratio;
  valueSampledData?: SampledData;
  valueTime?: string;
  valueDateTime?: string;
  valuePeriod?: Period;
  dataAbsentReason?: CodeableConcept;
  interpretation?: CodeableConcept[];
  note?: Annotation[];
  bodySite?: CodeableConcept;
  method?: CodeableConcept;
  specimen?: Reference;
  device?: Reference;
  referenceRange?: ObservationReferenceRange[];
  hasMember?: Reference[];
  derivedFrom?: Reference[];
  component?: ObservationComponent[];
}

// Supporting types for complex structures
export interface Annotation {
  authorReference?: Reference;
  authorString?: string;
  time?: string;
  text: string;
}

export interface Dosage {
  sequence?: number;
  text?: string;
  additionalInstruction?: CodeableConcept[];
  patientInstruction?: string;
  timing?: Timing;
  asNeededBoolean?: boolean;
  asNeededCodeableConcept?: CodeableConcept;
  site?: CodeableConcept;
  route?: CodeableConcept;
  method?: CodeableConcept;
  doseAndRate?: DosageDoseAndRate[];
  maxDosePerPeriod?: Ratio;
  maxDosePerAdministration?: Quantity;
  maxDosePerLifetime?: Quantity;
}

export interface Range {
  low?: Quantity;
  high?: Quantity;
}

export interface ConditionStage {
  summary?: CodeableConcept;
  assessment?: Reference[];
  type?: CodeableConcept;
}

export interface ConditionEvidence {
  code?: CodeableConcept[];
  detail?: Reference[];
}

export interface ProcedurePerformer {
  function?: CodeableConcept;
  actor: Reference;
  onBehalfOf?: Reference;
}

export interface ProcedureFocalDevice {
  action?: CodeableConcept;
  manipulated: Reference;
}

export interface ImmunizationPerformer {
  function?: CodeableConcept;
  actor: Reference;
}

export interface ImmunizationEducation {
  documentType?: string;
  reference?: string;
  publicationDate?: string;
  presentationDate?: string;
}

export interface ImmunizationReaction {
  date?: string;
  detail?: Reference;
  reported?: boolean;
}

export interface ImmunizationProtocolApplied {
  series?: string;
  authority?: Reference;
  targetDisease?: CodeableConcept[];
  doseNumberPositiveInt?: number;
  doseNumberString?: string;
  seriesDosesPositiveInt?: number;
  seriesDosesString?: string;
}

export interface Timing {
  event?: string[];
  repeat?: TimingRepeat;
  code?: CodeableConcept;
}

export interface TimingRepeat {
  boundsDuration?: Duration;
  boundsRange?: Range;
  boundsPeriod?: Period;
  count?: number;
  countMax?: number;
  duration?: number;
  durationMax?: number;
  durationUnit?: 's' | 'min' | 'h' | 'd' | 'wk' | 'mo' | 'a';
  frequency?: number;
  frequencyMax?: number;
  period?: number;
  periodMax?: number;
  periodUnit?: 's' | 'min' | 'h' | 'd' | 'wk' | 'mo' | 'a';
  dayOfWeek?: ('mon' | 'tue' | 'wed' | 'thu' | 'fri' | 'sat' | 'sun')[];
  timeOfDay?: string[];
  when?: ('MORN' | 'MORN.early' | 'MORN.late' | 'NOON' | 'AFT' | 'AFT.early' | 'AFT.late' | 'EVE' | 'EVE.early' | 'EVE.late' | 'NIGHT' | 'PHS' | 'HS' | 'WAKE' | 'C' | 'CM' | 'CD' | 'CV' | 'AC' | 'ACM' | 'ACD' | 'ACV' | 'PC' | 'PCM' | 'PCD' | 'PCV')[];
  offset?: number;
}

export interface Duration {
  value?: number;
  comparator?: '<' | '<=' | '>=' | '>';
  unit?: string;
  system?: string;
  code?: string;
}

export interface Ratio {
  numerator?: Quantity;
  denominator?: Quantity;
}

export interface SampledData {
  origin: Quantity;
  period: number;
  factor?: number;
  lowerLimit?: number;
  upperLimit?: number;
  dimensions: number;
  data?: string;
}

export interface ObservationReferenceRange {
  low?: Quantity;
  high?: Quantity;
  type?: CodeableConcept;
  appliesTo?: CodeableConcept[];
  age?: Range;
  text?: string;
}

export interface ObservationComponent {
  code: CodeableConcept;
  valueQuantity?: Quantity;
  valueCodeableConcept?: CodeableConcept;
  valueString?: string;
  valueBoolean?: boolean;
  valueInteger?: number;
  valueRange?: Range;
  valueRatio?: Ratio;
  valueSampledData?: SampledData;
  valueTime?: string;
  valueDateTime?: string;
  valuePeriod?: Period;
  dataAbsentReason?: CodeableConcept;
  interpretation?: CodeableConcept[];
  referenceRange?: ObservationReferenceRange[];
}

export interface DosageDoseAndRate {
  type?: CodeableConcept;
  doseRange?: Range;
  doseQuantity?: Quantity;
  rateRatio?: Ratio;
  rateRange?: Range;
  rateQuantity?: Quantity;
}

export interface ExaminationDetails {
  imageQuality: ImageQuality;
  technicalAspects: TechnicalAspects;
  measurementReference: string;
  limitations: string[];
}

export interface ImageQuality {
  resolution: 'Excelente' | 'Boa' | 'Regular' | 'Ruim';
  focus: 'N√≠tido' | 'Levemente desfocado' | 'Desfocado';
  lighting: 'Adequada' | 'Insuficiente' | 'Excessiva';
  positioning: 'Ideal' | 'Adequado' | 'Sub√≥timo';
  overallScore: number; // 1-10
}

export interface TechnicalAspects {
  hasRuler: boolean;
  rulerVisible: boolean;
  anatomicalReferences: string[];
  imageArtifacts: string[];
}

export interface ClinicalFindings {
  morphology: WoundMorphology;
  tissueAnalysis: TissueAnalysis;
  surroundingTissue: SurroundingTissue;
  vascularization: VascularAssessment;
  signs: ClinicalSigns;
}

export interface WoundMorphology {
  dimensions: {
    length: number;
    width: number;
    depth: number;
    area: number;
    unit: 'cm' | 'mm';
  };
  shape: 'Circular' | 'Oval' | 'Irregular' | 'Linear';
  edges: {
    definition: 'Bem definidas' | 'Irregulares' | 'Difusas';
    elevation: 'Planas' | 'Elevadas' | 'Invertidas';
    epithelialization: 'Presente' | 'Ausente' | 'Parcial';
  };
  depth: 'Superficial' | 'Parcial' | 'Total' | 'Profunda';
}

export interface TissueAnalysis {
  granulation: {
    percentage: number;
    quality: 'Saud√°vel' | 'P√°lido' | 'Fri√°vel' | 'Ausente';
    color: string;
  };
  necrotic: {
    percentage: number;
    type: 'Seco' | '√ömido' | 'Misto' | 'Ausente';
    adherence: 'Aderente' | 'Solto' | 'Parcialmente aderente';
  };
  fibrin: {
    percentage: number;
    distribution: 'Uniforme' | 'Localizada' | 'Ausente';
  };
  exposedStructures: string[];
}

export interface SurroundingTissue {
  skin: {
    color: 'Normal' | 'Eritematosa' | 'Cian√≥tica' | 'Hiperpigmentada';
    temperature: 'Normal' | 'Quente' | 'Fria';
    texture: 'Normal' | 'Ressecada' | 'Macerada';
    integrity: '√çntegra' | 'Lesionada' | 'Descamativa';
  };
  edema: {
    present: boolean;
    severity: 'Leve' | 'Moderado' | 'Intenso';
    distribution: 'Localizado' | 'Difuso';
  };
  pain: {
    present: boolean;
    intensity: number; // 0-10
    characteristics: string[];
  };
}

export interface VascularAssessment {
  perfusion: 'Adequada' | 'Comprometida' | 'Ausente';
  capillaryRefill: 'Normal' | 'Lento' | 'Ausente';
  pulses: 'Presentes' | 'Diminu√≠dos' | 'Ausentes';
  venousReturn: 'Normal' | 'Comprometido';
}

export interface ClinicalSigns {
  infection: {
    present: boolean;
    severity: 'Leve' | 'Moderada' | 'Grave';
    indicators: string[];
  };
  inflammation: {
    present: boolean;
    characteristics: string[];
  };
  exudate: {
    amount: 'Ausente' | 'Escasso' | 'Moderado' | 'Abundante';
    type: 'Seroso' | 'Sanguinolento' | 'Purulento' | 'Misto';
    color: string;
    odor: 'Ausente' | 'Leve' | 'Forte' | 'F√©tido';
  };
}

export interface DiagnosisSection {
  primary: PrimaryDiagnosis;
  differential: DifferentialDiagnosis[];
  classification: WoundClassification;
  prognosis: PrognosticFactors;
  riskFactors: RiskFactor[];
}

export interface PrimaryDiagnosis {
  condition: string;
  etiology: string;
  stage: string;
  severity: 'Leve' | 'Moderada' | 'Grave';
  confidence: number; // 0-100
  justification: string;
  
  // Campos expandidos para mais contexto e detalhes
  pathophysiology: {
    underlyingMechanism: string;
    tissueInvolvement: string;
    vascularImpact: string;
    inflammatoryResponse: string;
    healingPhase: 'Inflamat√≥ria' | 'Proliferativa' | 'Remodela√ß√£o' | 'Estagnada';
  };
  
  clinicalCorrelation: {
    anatomicalLocation: {
      region: string;
      laterality: 'Direita' | 'Esquerda' | 'Bilateral' | 'Central';
      proximityToStructures: string[];
      functionalImpact: string;
    };
    morphologicalCharacteristics: {
      primaryPattern: string;
      secondaryFeatures: string[];
      evolutionPattern: string;
      chronicityIndicators: string[];
    };
    systemicFactors: {
      metabolicInfluence: string[];
      vascularStatus: string;
      immunologicalFactors: string[];
      nutritionalImpact: string;
    };
  };
  
  diagnosticCertainty: {
    level: 'Definitivo' | 'Prov√°vel' | 'Poss√≠vel' | 'Suspeito';
    supportingEvidence: string[];
    limitingFactors: string[];
    recommendedConfirmation: string[];
  };
  
  prognosticImplications: {
    healingPotential: {
      intrinsicFactors: string[];
      extrinsicFactors: string[];
      timelineEstimate: string;
      probabilityScore: number; // 0-100
    };
    complicationRisk: {
      immediate: string[];
      shortTerm: string[];
      longTerm: string[];
      preventionStrategies: string[];
    };
    functionalOutcome: {
      expectedRecovery: string;
      potentialLimitations: string[];
      rehabilitationNeeds: string[];
    };
  };
  
  therapeuticImplications: {
    treatmentPriorities: string[];
    contraindicatedApproaches: string[];
    specialConsiderations: string[];
    monitoringRequirements: string[];
  };
}

export interface DifferentialDiagnosis {
  condition: string;
  probability: number; // 0-100
  supportingFindings: string[];
  excludingFactors: string[];
}

export interface WoundClassification {
  system: 'Wagner' | 'NPUAP' | 'CEAP' | 'Outro';
  grade: string;
  description: string;
}

export interface PrognosticFactors {
  healingPotential: 'Excelente' | 'Bom' | 'Regular' | 'Ruim';
  estimatedHealingTime: string;
  favorableFactors: string[];
  unfavorableFactors: string[];
  complications: PotentialComplication[];
}

export interface PotentialComplication {
  type: string;
  probability: 'Baixa' | 'Moderada' | 'Alta';
  prevention: string[];
}

export interface RiskFactor {
  factor: string;
  impact: 'Alto' | 'Moderado' | 'Baixo';
  modifiable: boolean;
  intervention: string;
}

export interface TreatmentRecommendations {
  immediate: ImmediateActions;
  ongoing: OngoingCare;
  monitoring: MonitoringPlan;
  referrals: Referral[];
  patientEducation: EducationPoints[];
  complicationRiskAssessment: ComplicationRiskAssessment;
}

export interface ComplicationRiskAssessment {
  overallRiskLevel: 'Baixo' | 'Moderado' | 'Alto' | 'Cr√≠tico';
  riskScore: number; // 0-100
  primaryRiskFactors: RiskFactor[];
  infectionRisk: {
    probability: 'Baixa' | 'Moderada' | 'Alta' | 'Muito Alta';
    indicators: string[];
    preventiveMeasures: string[];
    monitoringFrequency: string;
  };
  healingDelayRisk: {
    probability: 'Baixa' | 'Moderada' | 'Alta' | 'Muito Alta';
    contributingFactors: string[];
    interventions: string[];
    expectedTimeframe: string;
  };
  systemicComplicationRisk: {
    probability: 'Baixa' | 'Moderada' | 'Alta' | 'Muito Alta';
    potentialComplications: string[];
    warningSignsEducation: string[];
    emergencyProtocol: string[];
  };
  riskMitigationPlan: {
    immediateActions: string[];
    ongoingInterventions: string[];
    monitoringProtocol: string[];
    escalationCriteria: string[];
  };
  prognosticIndicators: {
    healingProbability: string;
    functionalRecovery: string;
    qualityOfLifeImpact: string;
    longTermOutlook: string;
  };
}

export interface ImmediateActions {
  cleaning: CleaningProtocol;
  debridement: DebridementPlan;
  dressing: DressingRecommendation;
  painManagement: PainManagement;
  infectionControl: InfectionControl;
}

export interface CleaningProtocol {
  solution: string;
  technique: string;
  frequency: string;
  precautions: string[];
}

export interface DebridementPlan {
  indicated: boolean;
  type: 'Cir√∫rgico' | 'Mec√¢nico' | 'Autol√≠tico' | 'Enzim√°tico';
  urgency: 'Imediato' | 'Dentro de 24h' | 'Eletivo';
  considerations: string[];
}

export interface DressingRecommendation {
  primary: {
    type: string;
    product: string;
    application: string;
  };
  secondary: {
    type: string;
    product: string;
    fixation: string;
  };
  changeFrequency: string;
  specialInstructions: string[];
}

export interface PainManagement {
  assessment: string;
  pharmacological: PharmacologicalTreatment[];
  nonPharmacological: string[];
  monitoring: string;
}

export interface PharmacologicalTreatment {
  medication: string;
  dosage: string;
  route: string;
  frequency: string;
  duration: string;
  precautions: string[];
}

export interface InfectionControl {
  riskLevel: 'Baixo' | 'Moderado' | 'Alto';
  preventiveMeasures: string[];
  antibioticTherapy?: AntibioticTherapy;
  cultureIndication: boolean;
  isolationPrecautions: string[];
}

export interface AntibioticTherapy {
  indication: string;
  agent: string;
  route: 'T√≥pico' | 'Oral' | 'Endovenoso';
  duration: string;
  monitoring: string[];
}

export interface OngoingCare {
  positioning: PositioningGuidelines;
  nutrition: NutritionalSupport;
  lifestyle: LifestyleModifications;
  comorbidityManagement: ComorbidityManagement[];
}

export interface PositioningGuidelines {
  pressureRelief: string[];
  frequency: string;
  devices: string[];
  contraindications: string[];
}

export interface NutritionalSupport {
  assessment: string;
  requirements: NutritionalRequirement[];
  supplements: string[];
  monitoring: string[];
}

export interface NutritionalRequirement {
  nutrient: string;
  amount: string;
  rationale: string;
}

export interface LifestyleModifications {
  smokingCessation: boolean;
  exerciseRecommendations: string[];
  stressManagement: string[];
  sleepHygiene: string[];
}

export interface ComorbidityManagement {
  condition: string;
  impact: string;
  management: string[];
  monitoring: string[];
}

export interface MonitoringPlan {
  frequency: string;
  parameters: MonitoringParameter[];
  warningSignsEducation: string[];
  followUpSchedule: FollowUpSchedule[];
}

export interface MonitoringParameter {
  parameter: string;
  method: string;
  frequency: string;
  targetValues: string;
  actionThresholds: string[];
}

export interface FollowUpSchedule {
  timeframe: string;
  provider: string;
  objectives: string[];
  assessments: string[];
}

export interface Referral {
  specialty: string;
  urgency: 'Urgente' | 'Priorit√°rio' | 'Eletivo';
  reason: string;
  expectedOutcome: string;
}

export interface EducationPoints {
  topic: string;
  keyPoints: string[];
  resources: string[];
  assessmentMethod: string;
}

export interface ReportFooter {
  limitations: string[];
  disclaimers: string[];
  legalConsiderations: string[];
  nextSteps: string[];
  emergencyContacts: EmergencyContact[];
}

export interface EmergencyContact {
  service: string;
  phone: string;
  availability: string;
  indications: string[];
}

export interface CardiovascularSystemicRiskAnalysis {
  overallCardiovascularRisk?: string;
  diabeticRiskAssessment?: {
    suspectedDiabetes?: boolean;
    diabeticFootRisk?: string;
    neuropathyIndicators?: string[];
  };
  vascularRiskAssessment?: {
    peripheralVascularDisease?: string;
    capillaryRefillAssessment?: string;
    arterialInsufficiencyIndicators?: string[];
  };
  hypertensionImpact?: string;
  nutritionalMetabolicFactors?: {
    proteinDeficiencyRisk?: string;
    nutritionalInterventions?: string[];
  };
  immunologicalFactors?: {
    immunocompromisedStatus?: string;
    infectionSusceptibility?: string;
    immunologicalSupport?: string[];
  };
  systemicInflammationMarkers?: string;
  cardiovascularOptimizationPlan?: string;
  integratedCareRecommendations?: {
    specialistReferrals?: Array<{
      specialty: string;
      indication: string;
      urgency: string;
    }>;
    coordinatedCareProtocol?: string[];
  };
}

export interface PrognosisAnalysis {
  healingTimeEstimate?: {
    optimistic?: string;
    realistic?: string;
    pessimistic?: string;
    factors?: string[];
  };
  healingProbability?: {
    complete?: number;
    partial?: number;
    complications?: number;
    reasoning?: string;
  };
  riskFactors?: {
    high?: string[];
    moderate?: string[];
    protective?: string[];
  };
  complicationRisk?: string;
  functionalOutcome?: string;
  qualityOfLifeImpact?: string;
  longTermPrognosis?: string;
}

export interface PersonalizedRecommendations {
  immediate?: {
    actions?: string[];
  };
  shortTerm?: {
    actions?: string[];
  };
  longTerm?: {
    actions?: string[];
  };
  highPriority?: string[];
  mediumPriority?: string[];
  lowPriority?: string[];
  patientSpecific?: string[];
  lifestyle?: {
    nutrition?: string[];
    activity?: string[];
    sleep?: string[];
    stress?: string[];
    hygiene?: string[];
    environment?: string[];
  };
  followUp?: string[];
}

export interface TreatmentOptimization {
  currentTreatment?: string;
  optimizations?: string[];
  alternatives?: string[];
  contraindications?: string[];
  drugInteractions?: string[];
}

export interface QualityOfLife {
  impact?: {
    physical?: string;
    emotional?: string;
    social?: string;
  };
  supportStrategies?: string[];
  adaptations?: string[];
}

export interface FollowUpPlan {
  schedule?: {
    week1?: string;
    week2?: string;
    month1?: string;
    ongoing?: string;
  };
  specialists?: string[];
  tests?: string[];
  documentation?: string[];
}

export interface EvidenceBased {
  guidelines?: string[];
  research?: string[];
  confidence?: string;
}

// Template de prompt estruturado seguindo padr√µes internacionais
export const createStructuredPrompt = (patientContext?: any): string => {
  const currentDate = new Date().toLocaleDateString('pt-BR');
  const currentTime = new Date().toLocaleTimeString('pt-BR');
  const protocolNumber = `CFI-${Date.now().toString().slice(-8)}`;

  return `
SISTEMA DE AN√ÅLISE M√âDICA AVAN√áADA - LAUDO ESTRUTURADO INTERNACIONAL
================================================================

CONFORMIDADE COM PADR√ïES INTERNACIONAIS:

1. HL7 FHIR R4 - Fast Healthcare Interoperability Resources
   ‚úì DiagnosticReport Resource structure
   ‚úì Observation Resource for clinical findings
   ‚úì Patient Resource compliance
   ‚úì CodeableConcept with standardized terminologies
   ‚úì Reference linking between resources
   ‚úì Meta information for versioning and profiles

2. DICOM - Digital Imaging and Communications in Medicine
   ‚úì Patient Module (0010,xxxx) compliance
   ‚úì Study and Series identification
   ‚úì Image metadata preservation
   ‚úì Structured reporting templates (SR IODs)
   ‚úì Acquisition context preservation

3. IHE XDS-I - Cross-Enterprise Document Sharing for Imaging
   ‚úì Document metadata compliance
   ‚úì Clinical context preservation
   ‚úì Interoperability standards
   ‚úì Registry/Repository architecture support

TERMINOLOGIAS PADRONIZADAS OBRIGAT√ìRIAS:
‚Ä¢ SNOMED CT - Conceitos cl√≠nicos, anatomia, procedimentos
‚Ä¢ LOINC - Observa√ß√µes laboratoriais e cl√≠nicas
‚Ä¢ ICD-10-CM - Diagn√≥sticos e condi√ß√µes
‚Ä¢ ICD-10-PCS - Procedimentos
‚Ä¢ UCUM - Unidades de medida
‚Ä¢ RxNorm - Medicamentos
‚Ä¢ CPT - Procedimentos m√©dicos
‚Ä¢ ISO 3166 - C√≥digos de pa√≠s
‚Ä¢ ISO 639 - C√≥digos de idioma
‚Ä¢ ISO 8601 - Formato de data/hora

INSTRU√á√ïES PARA AN√ÅLISE:
Voc√™ deve analisar a imagem m√©dica fornecida e gerar um laudo estruturado seguindo EXATAMENTE o formato JSON especificado abaixo, em conformidade com os padr√µes HL7 FHIR R4, DICOM e IHE XDS-I. Cada se√ß√£o deve ser preenchida com base na an√°lise visual da ferida/les√£o usando terminologias m√©dicas padronizadas.

CRIT√âRIOS DE AN√ÅLISE INTERNACIONAL:
1. LOCALIZA√á√ÉO ANAT√îMICA (SNOMED CT):
   - Use c√≥digos SNOMED CT para estruturas anat√¥micas
   - Lateralidade (direita/esquerda) quando aplic√°vel
   - Regi√£o corporal espec√≠fica com coordenadas

2. DIMENS√ïES E MEDIDAS (UCUM):
   - Comprimento, largura, profundidade em cent√≠metros
   - √Årea da les√£o em cm¬≤
   - Volume quando calcul√°vel
   - Unidades padronizadas UCUM

3. CARACTER√çSTICAS VISUAIS (SNOMED CT):
   - Cor: c√≥digos para eritema, cianose, palidez
   - Textura: lisa, rugosa, irregular
   - Bordas: bem definidas, irregulares, elevadas
   - Exsudato: tipo, quantidade, cor, odor
   - Tecido necr√≥tico: percentual, tipo

4. CLASSIFICA√á√ÉO INTERNACIONAL:
   - Wagner Classification (diabetes)
   - University of Texas Classification
   - NPUAP/EPUAP Pressure Ulcer Classification
   - TIME framework (Tissue, Infection, Moisture, Edge)

5. SINAIS DE INFEC√á√ÉO (SNOMED CT):
   - Eritema perilesional
   - Edema local
   - Calor aumentado
   - Exsudato purulento
   - Odor caracter√≠stico
   - Dor/sensibilidade

6. PROCESSO DE CICATRIZA√á√ÉO:
   - Fase inflamat√≥ria
   - Fase proliferativa
   - Fase de remodela√ß√£o
   - Tecido de granula√ß√£o (qualidade/quantidade)
   - Epiteliza√ß√£o

VALIDA√á√ÉO CL√çNICA:
- Correlacione com guidelines internacionais
- Aplique escalas de avalia√ß√£o validadas
- Considere fatores de risco sist√™micos
- Avalie necessidade de bi√≥psia
- Determine urg√™ncia do tratamento

LIMITA√á√ïES E RECOMENDA√á√ïES:
- Documente limita√ß√µes da an√°lise por imagem
- Recomende avalia√ß√£o presencial quando necess√°rio
- Sugira exames complementares
- Indique necessidade de culturas
- Mantenha objetividade cient√≠fica baseada em evid√™ncias

CONTEXTO DO PACIENTE:
- Nome: ${patientContext?.nome || 'PACIENTE N√ÉO IDENTIFICADO'}
- Idade: ${patientContext?.idade || 'N√£o informada'}
- Sexo: ${patientContext?.sexo || 'N√£o informado'}
- Localiza√ß√£o da Les√£o: ${patientContext?.localizacaoLesao || 'N√£o especificada'}

FORMATO DE RESPOSTA OBRIGAT√ìRIO:
Responda APENAS com um objeto JSON v√°lido seguindo esta estrutura:

{
  "header": {
    "title": "LAUDO M√âDICO DIGITAL - AN√ÅLISE AVAN√áADA DE FERIDA IA",
    "protocol": "${protocolNumber}",
    "date": "${currentDate}",
    "time": "${currentTime}",
    "institution": "Sistema Fecha Ferida IA",
    "system": "Fecha Ferida IA v3.0",
    "version": "3.0.0",
    "responsiblePhysician": "Dr. Sistema IA Avan√ßado",
    "crm": "IA-2024-ADV"
  },
  "patientInfo": {
    "name": "${patientContext?.nome || 'PACIENTE N√ÉO IDENTIFICADO'}",
    "age": "${patientContext?.idade || 'N√£o informada'}",
    "gender": "${patientContext?.sexo || 'N√£o informado'}",
    "patientId": "TEMP_${Date.now().toString().slice(-6)}",
    "lesionLocation": "${patientContext?.localizacaoLesao || 'N√£o especificada'}",
    "medicalHistory": "Baseado na an√°lise visual - hist√≥rico n√£o dispon√≠vel",
    "allergies": "N√£o informado",
    "currentMedications": "N√£o informado"
  },
  "examination": {
    "imageQuality": {
      "resolution": "[Excelente|Boa|Regular|Ruim]",
      "focus": "[N√≠tido|Levemente desfocado|Desfocado]",
      "lighting": "[Adequada|Insuficiente|Excessiva]",
      "positioning": "[Ideal|Adequado|Sub√≥timo]",
      "overallScore": [n√∫mero de 1-10]
    },
    "technicalAspects": {
      "hasRuler": [true|false],
      "rulerVisible": [true|false],
      "anatomicalReferences": ["lista de refer√™ncias anat√¥micas vis√≠veis"],
      "imageArtifacts": ["lista de artefatos ou limita√ß√µes"]
    },
    "measurementReference": "Descri√ß√£o da refer√™ncia de medida dispon√≠vel",
    "limitations": ["lista de limita√ß√µes da an√°lise por imagem"]
  },
  "findings": {
    "morphology": {
      "dimensions": {
        "length": [n√∫mero estimado],
        "width": [n√∫mero estimado],
        "depth": [n√∫mero estimado],
        "area": [n√∫mero estimado],
        "unit": "cm"
      },
      "shape": "[Circular|Oval|Irregular|Linear]",
      "edges": {
        "definition": "[Bem definidas|Irregulares|Difusas]",
        "elevation": "[Planas|Elevadas|Invertidas]",
        "epithelialization": "[Presente|Ausente|Parcial]"
      },
      "depth": "[Superficial|Parcial|Total|Profunda]"
    },
    "tissueAnalysis": {
      "granulation": {
        "percentage": [0-100],
        "quality": "[Saud√°vel|P√°lido|Fri√°vel|Ausente]",
        "color": "descri√ß√£o da cor"
      },
      "necrotic": {
        "percentage": [0-100],
        "type": "[Seco|√ömido|Misto|Ausente]",
        "adherence": "[Aderente|Solto|Parcialmente aderente]"
      },
      "fibrin": {
        "percentage": [0-100],
        "distribution": "[Uniforme|Localizada|Ausente]"
      },
      "exposedStructures": ["lista de estruturas expostas"]
    },
    "surroundingTissue": {
      "skin": {
        "color": "[Normal|Eritematosa|Cian√≥tica|Hiperpigmentada]",
        "temperature": "[Normal|Quente|Fria]",
        "texture": "[Normal|Ressecada|Macerada]",
        "integrity": "[√çntegra|Lesionada|Descamativa]"
      },
      "edema": {
        "present": [true|false],
        "severity": "[Leve|Moderado|Intenso]",
        "distribution": "[Localizado|Difuso]"
      },
      "pain": {
        "present": [true|false],
        "intensity": [0-10],
        "characteristics": ["lista de caracter√≠sticas da dor"]
      }
    },
    "vascularization": {
      "perfusion": "[Adequada|Comprometida|Ausente]",
      "capillaryRefill": "[Normal|Lento|Ausente]",
      "pulses": "[Presentes|Diminu√≠dos|Ausentes]",
      "venousReturn": "[Normal|Comprometido]"
    },
    "signs": {
      "infection": {
        "present": [true|false],
        "severity": "[Leve|Moderada|Grave]",
        "indicators": ["lista de indicadores de infec√ß√£o"]
      },
      "inflammation": {
        "present": [true|false],
        "characteristics": ["lista de caracter√≠sticas inflamat√≥rias"]
      },
      "exudate": {
        "amount": "[Ausente|Escasso|Moderado|Abundante]",
        "type": "[Seroso|Sanguinolento|Purulento|Misto]",
        "color": "descri√ß√£o da cor",
        "odor": "[Ausente|Leve|Forte|F√©tido]"
      }
    }
  },
  "diagnosis": {
    "primary": {
      "condition": "Diagn√≥stico principal baseado na an√°lise detalhada dos achados cl√≠nicos, considerando a apresenta√ß√£o morfol√≥gica, localiza√ß√£o anat√¥mica, caracter√≠sticas do tecido e contexto cl√≠nico do paciente",
      "etiology": "Etiologia prov√°vel com base nos fatores de risco identificados, mecanismo de les√£o, hist√≥ria cl√≠nica e achados f√≠sicos espec√≠ficos",
      "stage": "Est√°gio ou grau da les√£o conforme classifica√ß√£o apropriada (Wagner, NPUAP, CEAP ou outra aplic√°vel)",
      "severity": "[Leve|Moderada|Grave]",
      "confidence": [0-100],
      "justification": "Justificativa detalhada e fundamentada do diagn√≥stico, incluindo: 1) Correla√ß√£o entre achados cl√≠nicos e diagn√≥stico proposto, 2) An√°lise diferencial com outras condi√ß√µes similares, 3) Fatores que confirmam ou excluem diagn√≥sticos alternativos, 4) Considera√ß√µes sobre a evolu√ß√£o temporal da les√£o, 5) Impacto dos fatores sist√™micos e locais no quadro cl√≠nico",
      "pathophysiology": "Explica√ß√£o detalhada dos mecanismos fisiopatol√≥gicos envolvidos na forma√ß√£o e perpetua√ß√£o da les√£o, incluindo processos inflamat√≥rios, vasculares, metab√≥licos e de cicatriza√ß√£o",
      "clinicalCorrelation": "Correla√ß√£o entre os achados cl√≠nicos observados e o conhecimento cient√≠fico estabelecido, destacando aspectos t√≠picos e at√≠picos da apresenta√ß√£o",
      "diagnosticCertainty": {
        "level": "[Definitivo|Prov√°vel|Poss√≠vel|Suspeito]",
        "supportingEvidence": ["Lista de evid√™ncias que suportam o diagn√≥stico"],
        "limitingFactors": ["Fatores que limitam a certeza diagn√≥stica"],
        "recommendedConfirmation": ["Exames ou avalia√ß√µes adicionais recomendados para confirma√ß√£o"]
      },
      "prognosticImplications": {
        "healingPotential": {
          "intrinsicFactors": ["Fatores intr√≠nsecos que influenciam a cicatriza√ß√£o"],
          "extrinsicFactors": ["Fatores extr√≠nsecos modific√°veis"],
          "timelineEstimate": "Estimativa temporal real√≠stica para cicatriza√ß√£o",
          "probabilityScore": [0-100]
        },
        "complicationRisk": {
          "immediate": ["Riscos de complica√ß√µes imediatas"],
          "shortTerm": ["Riscos a curto prazo"],
          "longTerm": ["Riscos a longo prazo"],
          "preventionStrategies": ["Estrat√©gias espec√≠ficas de preven√ß√£o"]
        },
        "functionalOutcome": {
          "expectedRecovery": "Expectativa de recupera√ß√£o funcional",
          "potentialLimitations": ["Limita√ß√µes funcionais potenciais"],
          "rehabilitationNeeds": ["Necessidades de reabilita√ß√£o"]
        }
      },
      "therapeuticImplications": {
        "treatmentPriorities": ["Prioridades terap√™uticas baseadas no diagn√≥stico"],
        "contraindicatedApproaches": ["Abordagens contraindicadas"],
        "specialConsiderations": ["Considera√ß√µes especiais para o tratamento"],
        "monitoringRequirements": ["Requisitos espec√≠ficos de monitoramento"]
      }
    },
    "differential": [
      {
        "condition": "Diagn√≥stico diferencial 1",
        "probability": [0-100],
        "supportingFindings": ["achados que suportam"],
        "excludingFactors": ["fatores que excluem"]
      }
    ],
    "classification": {
      "system": "Sistema de classifica√ß√£o aplic√°vel",
      "grade": "Grau ou est√°gio",
      "description": "Descri√ß√£o da classifica√ß√£o"
    },
    "prognosis": {
      "healingPotential": "[Excelente|Bom|Regular|Ruim]",
      "estimatedHealingTime": "Tempo estimado de cicatriza√ß√£o",
      "favorableFactors": ["fatores favor√°veis"],
      "unfavorableFactors": ["fatores desfavor√°veis"],
      "complications": [
        {
          "type": "Tipo de complica√ß√£o",
          "probability": "[Baixa|Moderada|Alta]",
          "prevention": ["medidas preventivas"]
        }
      ]
    },
    "riskFactors": [
      {
        "factor": "Fator de risco",
        "impact": "[Alto|Moderado|Baixo]",
        "modifiable": [true|false],
        "intervention": "Interven√ß√£o recomendada"
      }
    ]
  },
  "recommendations": {
    "immediate": {
      "cleaning": {
        "solution": "Solu√ß√£o recomendada",
        "technique": "T√©cnica de limpeza",
        "frequency": "Frequ√™ncia",
        "precautions": ["precau√ß√µes especiais"]
      },
      "debridement": {
        "indicated": [true|false],
        "type": "[Cir√∫rgico|Mec√¢nico|Autol√≠tico|Enzim√°tico]",
        "urgency": "[Imediato|Dentro de 24h|Eletivo]",
        "considerations": ["considera√ß√µes especiais"]
      },
      "dressing": {
        "primary": {
          "type": "Tipo de cobertura prim√°ria",
          "product": "Produto espec√≠fico",
          "application": "Modo de aplica√ß√£o"
        },
        "secondary": {
          "type": "Tipo de cobertura secund√°ria",
          "product": "Produto espec√≠fico",
          "fixation": "M√©todo de fixa√ß√£o"
        },
        "changeFrequency": "Frequ√™ncia de troca",
        "specialInstructions": ["instru√ß√µes especiais"]
      },
      "painManagement": {
        "assessment": "Avalia√ß√£o da dor",
        "pharmacological": [
          {
            "medication": "Medicamento",
            "dosage": "Dosagem",
            "route": "Via de administra√ß√£o",
            "frequency": "Frequ√™ncia",
            "duration": "Dura√ß√£o",
            "precautions": ["precau√ß√µes"]
          }
        ],
        "nonPharmacological": ["medidas n√£o farmacol√≥gicas"],
        "monitoring": "Monitoramento da dor"
      },
      "infectionControl": {
        "riskLevel": "[Baixo|Moderado|Alto]",
        "preventiveMeasures": ["medidas preventivas"],
        "cultureIndication": [true|false],
        "isolationPrecautions": ["precau√ß√µes de isolamento"]
      }
    },
    "ongoing": {
      "positioning": {
        "pressureRelief": ["orienta√ß√µes de al√≠vio de press√£o"],
        "frequency": "Frequ√™ncia de mudan√ßa de posi√ß√£o",
        "devices": ["dispositivos recomendados"],
        "contraindications": ["contraindica√ß√µes"]
      },
      "nutrition": {
        "assessment": "Avalia√ß√£o nutricional",
        "requirements": [
          {
            "nutrient": "Nutriente",
            "amount": "Quantidade",
            "rationale": "Justificativa"
          }
        ],
        "supplements": ["suplementos recomendados"],
        "monitoring": ["par√¢metros de monitoramento"]
      },
      "lifestyle": {
        "smokingCessation": [true|false],
        "exerciseRecommendations": ["recomenda√ß√µes de exerc√≠cio"],
        "stressManagement": ["manejo do estresse"],
        "sleepHygiene": ["higiene do sono"]
      },
      "comorbidityManagement": [
        {
          "condition": "Comorbidade",
          "impact": "Impacto na cicatriza√ß√£o",
          "management": ["manejo espec√≠fico"],
          "monitoring": ["monitoramento necess√°rio"]
        }
      ]
    },
    "monitoring": {
      "frequency": "Frequ√™ncia de reavalia√ß√£o",
      "parameters": [
        {
          "parameter": "Par√¢metro a monitorar",
          "method": "M√©todo de avalia√ß√£o",
          "frequency": "Frequ√™ncia",
          "targetValues": "Valores alvo",
          "actionThresholds": ["limites para a√ß√£o"]
        }
      ],
      "warningSignsEducation": ["sinais de alerta"],
      "followUpSchedule": [
        {
          "timeframe": "Prazo",
          "provider": "Profissional",
          "objectives": ["objetivos da consulta"],
          "assessments": ["avalia√ß√µes necess√°rias"]
        }
      ]
    },
    "referrals": [
      {
        "specialty": "Especialidade",
        "urgency": "[Urgente|Priorit√°rio|Eletivo]",
        "reason": "Motivo do encaminhamento",
        "expectedOutcome": "Resultado esperado"
      }
    ],
    "patientEducation": [
      {
        "topic": "T√≥pico educacional",
        "keyPoints": ["pontos principais"],
        "resources": ["recursos educacionais"],
        "assessmentMethod": "M√©todo de avalia√ß√£o do aprendizado"
      }
    ],
    "cardiovascularSystemicRiskAnalysis": {
      "overallCardiovascularRisk": "[Baixo|Moderado|Alto|Cr√≠tico]",
      "diabeticRiskAssessment": {
        "suspectedDiabetes": [true|false],
        "diabeticFootRisk": "[Baixo|Moderado|Alto|Muito Alto]",
        "neuropathyIndicators": ["indicadores de neuropatia observados"],
        "vasculopathyIndicators": ["indicadores de vasculopatia observados"],
        "glycemicControlRecommendations": ["recomenda√ß√µes para controle glic√™mico"],
        "diabeticFootCareEducation": ["orienta√ß√µes espec√≠ficas para cuidados com p√© diab√©tico"]
      },
      "vascularRiskAssessment": {
        "peripheralVascularDisease": "[Ausente|Suspeita|Prov√°vel|Confirmada]",
        "arterialInsufficiencyIndicators": ["indicadores de insufici√™ncia arterial"],
        "venousInsufficiencyIndicators": ["indicadores de insufici√™ncia venosa"],
        "capillaryRefillAssessment": "Avalia√ß√£o do enchimento capilar",
        "vascularInterventionNeeds": ["necessidades de interven√ß√£o vascular"],
        "compressionTherapyIndications": ["indica√ß√µes para terapia compressiva"]
      },
      "hypertensionImpact": {
        "bloodPressureControlImportance": "Import√¢ncia do controle press√≥rico para cicatriza√ß√£o",
        "antihypertensiveConsiderations": ["considera√ß√µes sobre anti-hipertensivos"],
        "targetBloodPressure": "Press√£o arterial alvo para otimizar cicatriza√ß√£o"
      },
      "nutritionalMetabolicFactors": {
        "proteinDeficiencyRisk": "[Baixo|Moderado|Alto]",
        "vitaminDeficiencyIndicators": ["indicadores de defici√™ncias vitam√≠nicas"],
        "mineralDeficiencyIndicators": ["indicadores de defici√™ncias minerais"],
        "nutritionalInterventions": ["interven√ß√µes nutricionais espec√≠ficas"],
        "metabolicOptimizationPlan": ["plano de otimiza√ß√£o metab√≥lica"]
      },
      "immunologicalFactors": {
        "immunocompromisedStatus": "[N√£o|Suspeita|Confirmada]",
        "immunosuppressionCauses": ["causas de imunossupress√£o identificadas"],
        "infectionSusceptibility": "[Baixa|Moderada|Alta|Muito Alta]",
        "immunologicalSupport": ["medidas de suporte imunol√≥gico"],
        "vaccinationRecommendations": ["recomenda√ß√µes de vacina√ß√£o"]
      },
      "systemicInflammationMarkers": {
        "chronicInflammationIndicators": ["indicadores de inflama√ß√£o cr√¥nica"],
        "autoimmuneDiseaseRisk": "[Baixo|Moderado|Alto]",
        "antiInflammatoryStrategies": ["estrat√©gias anti-inflamat√≥rias"],
        "systemicTreatmentConsiderations": ["considera√ß√µes para tratamento sist√™mico"]
      },
      "cardiovascularOptimizationPlan": {
        "cardiacRiskStratification": "Estratifica√ß√£o de risco card√≠aco",
        "exerciseRecommendations": ["recomenda√ß√µes de exerc√≠cio adaptadas"],
        "cardiovascularMedications": ["medica√ß√µes cardiovasculares a considerar"],
        "cardiologyReferralIndications": ["indica√ß√µes para encaminhamento cardiol√≥gico"],
        "cardiovascularMonitoring": ["par√¢metros de monitoramento cardiovascular"]
      },
      "endocrinologicalConsiderations": {
        "hormonalFactors": ["fatores hormonais que afetam cicatriza√ß√£o"],
        "thyroidFunctionImpact": "Impacto da fun√ß√£o tireoidiana",
        "corticosteroidEffects": ["efeitos de corticosteroides na cicatriza√ß√£o"],
        "endocrinologicalReferral": ["indica√ß√µes para encaminhamento endocrinol√≥gico"],
        "hormonalOptimization": ["estrat√©gias de otimiza√ß√£o hormonal"]
      },
      "renalHepaticConsiderations": {
        "renalFunctionImpact": "Impacto da fun√ß√£o renal na cicatriza√ß√£o",
        "hepaticFunctionImpact": "Impacto da fun√ß√£o hep√°tica",
        "drugMetabolismConsiderations": ["considera√ß√µes sobre metabolismo de medicamentos"],
        "nephroHepatoprotectiveStrategies": ["estrat√©gias nefroprotetoras e hepatoprotetoras"]
      },
      "psychosocialFactors": {
        "depressionAnxietyImpact": "Impacto de depress√£o/ansiedade na cicatriza√ß√£o",
        "socialSupportAssessment": "Avalia√ß√£o do suporte social",
        "adherenceBarriers": ["barreiras √† ader√™ncia ao tratamento"],
        "psychosocialInterventions": ["interven√ß√µes psicossociais recomendadas"],
        "qualityOfLifeConsiderations": ["considera√ß√µes sobre qualidade de vida"]
      },
      "integratedCareRecommendations": {
        "multidisciplinaryTeamNeeds": ["necessidades de equipe multidisciplinar"],
        "specialistReferrals": [
          {
            "specialty": "Especialidade m√©dica",
            "indication": "Indica√ß√£o espec√≠fica",
            "urgency": "[Rotina|Urgente|Emergencial]",
            "expectedOutcome": "Resultado esperado"
          }
        ],
        "coordinatedCareProtocol": ["protocolo de cuidado coordenado"],
        "systemicOptimizationTimeline": "Cronograma de otimiza√ß√£o sist√™mica"
      }
    },
    "complicationRiskAssessment": {
      "overallRiskLevel": "[Baixo|Moderado|Alto|Cr√≠tico]",
      "riskScore": 0,
      "primaryRiskFactors": [
        {
          "factor": "Fator de risco identificado",
          "impact": "[Alto|Moderado|Baixo]",
          "modifiable": true,
          "intervention": "Interven√ß√£o recomendada"
        }
      ],
      "infectionRisk": {
        "probability": "[Baixa|Moderada|Alta|Muito Alta]",
        "indicators": ["indicadores de risco infeccioso"],
        "preventiveMeasures": ["medidas preventivas espec√≠ficas"],
        "monitoringFrequency": "Frequ√™ncia de monitoramento"
      },
      "healingDelayRisk": {
        "probability": "[Baixa|Moderada|Alta|Muito Alta]",
        "contributingFactors": ["fatores que podem atrasar a cicatriza√ß√£o"],
        "interventions": ["interven√ß√µes para otimizar cicatriza√ß√£o"],
        "expectedTimeframe": "Tempo esperado para cicatriza√ß√£o"
      },
      "systemicComplicationRisk": {
        "probability": "[Baixa|Moderada|Alta|Muito Alta]",
        "potentialComplications": ["complica√ß√µes sist√™micas poss√≠veis"],
        "warningSignsEducation": ["sinais de alerta para o paciente"],
        "emergencyProtocol": ["protocolo de emerg√™ncia"]
      },
      "riskMitigationPlan": {
        "immediateActions": ["a√ß√µes imediatas para reduzir riscos"],
        "ongoingInterventions": ["interven√ß√µes cont√≠nuas"],
        "monitoringProtocol": ["protocolo de monitoramento"],
        "escalationCriteria": ["crit√©rios para escala√ß√£o do cuidado"]
      },
      "prognosticIndicators": {
        "healingProbability": "Probabilidade de cicatriza√ß√£o completa",
        "functionalRecovery": "Expectativa de recupera√ß√£o funcional",
        "qualityOfLifeImpact": "Impacto na qualidade de vida",
        "longTermOutlook": "Progn√≥stico a longo prazo"
      }
    }
  },
  "prognosisAnalysis": {
    "healingTimeEstimate": {
      "optimistic": "[tempo em semanas]",
      "realistic": "[tempo em semanas]",
      "pessimistic": "[tempo em semanas]",
      "factors": ["fatores que influenciam o tempo de cicatriza√ß√£o"]
    },
    "healingProbability": {
      "complete": "[porcentagem 0-100]",
      "partial": "[porcentagem 0-100]",
      "complications": "[porcentagem 0-100]",
      "reasoning": "Justificativa baseada nos achados"
    },
    "riskFactors": {
      "high": ["fatores de alto risco identificados"],
      "moderate": ["fatores de risco moderado"],
      "protective": ["fatores protetivos presentes"]
    },
    "criticalIndicators": {
      "warning": ["sinais de alerta para monitoramento"],
      "improvement": ["indicadores de melhora esperados"],
      "deterioration": ["sinais de piora a observar"]
    }
  },
  "personalizedRecommendations": {
    "immediate": {
      "priority": "alta",
      "actions": ["a√ß√µes imediatas necess√°rias"],
      "timeline": "24-48 horas"
    },
    "shortTerm": {
      "priority": "alta",
      "actions": ["a√ß√µes para 1-2 semanas"],
      "timeline": "1-2 semanas"
    },
    "longTerm": {
      "priority": "m√©dia",
      "actions": ["a√ß√µes para seguimento prolongado"],
      "timeline": "1-3 meses"
    },
    "lifestyle": {
      "nutrition": ["recomenda√ß√µes nutricionais espec√≠ficas"],
      "activity": ["orienta√ß√µes de atividade f√≠sica"],
      "hygiene": ["cuidados de higiene personalizados"],
      "environment": ["modifica√ß√µes ambientais sugeridas"]
    },
    "monitoring": {
      "frequency": "[frequ√™ncia de avalia√ß√£o recomendada]",
      "parameters": ["par√¢metros espec√≠ficos a monitorar"],
      "tools": ["ferramentas de monitoramento sugeridas"],
      "alerts": ["quando buscar atendimento urgente"]
    }
  },
  "treatmentOptimization": {
    "currentApproach": {
      "effectiveness": "[alta|m√©dia|baixa]",
      "adjustments": ["ajustes sugeridos no tratamento atual"]
    },
    "alternativeOptions": {
      "conservative": ["op√ß√µes conservadoras adicionais"],
      "advanced": ["terapias avan√ßadas a considerar"],
      "surgical": ["interven√ß√µes cir√∫rgicas se aplic√°vel"]
    },
    "contraindications": ["tratamentos a evitar baseado no caso"],
    "drugInteractions": ["poss√≠veis intera√ß√µes medicamentosas"]
  },
  "qualityOfLife": {
    "impact": {
      "physical": "Impacto f√≠sico esperado",
      "emotional": "Impacto emocional a considerar",
      "social": "Impacto social e funcional"
    },
    "supportStrategies": ["estrat√©gias de suporte recomendadas"],
    "adaptations": ["adapta√ß√µes necess√°rias no dia a dia"]
  },
  "followUpPlan": {
    "schedule": {
      "week1": "Avalia√ß√£o em 1 semana",
      "week2": "Avalia√ß√£o em 2 semanas",
      "month1": "Avalia√ß√£o em 1 m√™s",
      "ongoing": "Seguimento cont√≠nuo"
    },
    "specialists": ["especialistas a consultar"],
    "tests": ["exames complementares sugeridos"],
    "documentation": ["documenta√ß√£o necess√°ria para seguimento"]
  },
  "evidenceBased": {
    "guidelines": ["diretrizes cl√≠nicas aplic√°veis"],
    "research": ["evid√™ncias cient√≠ficas relevantes"],
    "confidence": "[alta|m√©dia|baixa] - n√≠vel de confian√ßa da an√°lise"
  },
  "footer": {
    "limitations": ["limita√ß√µes da an√°lise"],
    "disclaimers": ["avisos importantes"],
    "legalConsiderations": ["considera√ß√µes legais"],
    "nextSteps": ["pr√≥ximos passos"],
    "emergencyContacts": [
      {
        "service": "Servi√ßo de emerg√™ncia",
        "phone": "Telefone",
        "availability": "Disponibilidade",
        "indications": ["indica√ß√µes para contato"]
      }
    ]
  }
}

DIRETRIZES CR√çTICAS:
1. Responda APENAS com o JSON v√°lido - sem texto adicional
2. Analise cuidadosamente todos os aspectos vis√≠veis da ferida
3. Use terminologia m√©dica precisa
4. Inclua percentuais de confian√ßa realistas
5. Seja espec√≠fico nas recomenda√ß√µes
6. Considere fatores de risco e progn√≥stico
7. Forne√ßa orienta√ß√µes pr√°ticas e aplic√°veis
8. Mantenha consist√™ncia entre achados e recomenda√ß√µes

INSTRU√á√ïES ESPEC√çFICAS PARA IMPRESS√ÉO DIAGN√ìSTICA:
9. FISIOPATOLOGIA: Explique detalhadamente os mecanismos biol√≥gicos envolvidos na forma√ß√£o e perpetua√ß√£o da les√£o, incluindo:
   - Processos inflamat√≥rios (agudo vs cr√¥nico, mediadores envolvidos)
   - Altera√ß√µes vasculares (perfus√£o, permeabilidade, angiog√™nese)
   - Metabolismo celular e tecidual (hip√≥xia, acidose, ac√∫mulo de metab√≥litos)
   - Cascata de cicatriza√ß√£o (hemostasia, inflama√ß√£o, prolifera√ß√£o, remodela√ß√£o)
   - Fatores que interferem na cicatriza√ß√£o normal

10. CORRELA√á√ÉO CL√çNICA: Estabele√ßa conex√µes claras entre:
    - Achados visuais observados e conhecimento cient√≠fico estabelecido
    - Apresenta√ß√£o atual e evolu√ß√£o temporal esperada
    - Fatores sist√™micos do paciente e manifesta√ß√µes locais
    - Sinais cl√≠nicos e processos fisiopatol√≥gicos subjacentes
    - Aspectos t√≠picos e at√≠picos da apresenta√ß√£o

11. AN√ÅLISE DIAGN√ìSTICA DETALHADA: Para cada diagn√≥stico, inclua:
    - Justificativa baseada em evid√™ncias espec√≠ficas observadas
    - An√°lise diferencial com outras condi√ß√µes similares
    - Fatores que confirmam ou excluem diagn√≥sticos alternativos
    - Grau de certeza diagn√≥stica com fundamenta√ß√£o
    - Implica√ß√µes progn√≥sticas e terap√™uticas espec√≠ficas

12. CONTEXTUALIZA√á√ÉO CL√çNICA: Considere sempre:
    - Hist√≥ria cl√≠nica e fatores predisponentes
    - Comorbidades e seu impacto na cicatriza√ß√£o
    - Fatores ambientais e sociais relevantes
    - Tratamentos pr√©vios e sua efic√°cia
    - Expectativas realistas de evolu√ß√£o

ANALISE A IMAGEM E GERE O LAUDO ESTRUTURADO EM JSON.
`;
};